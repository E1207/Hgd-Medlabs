spring:
  application:
    name: medlab
  
  datasource:
    url: jdbc:postgresql://localhost:5432/medlab
    username: ${DB_USERNAME:}
    password: ${DB_PASSWORD:}
    driver-class-name: org.postgresql.Driver
  
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        format_sql: true
    open-in-view: false
  
  thymeleaf:
    check-template-location: false
  
  mail:
    host: ${EMAIL_HOST:smtp.gmail.com}
    port: ${EMAIL_PORT:587}
    username: ${EMAIL_USERNAME:}
    password: ${EMAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000
  
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 10MB

server:
  port: 8080
  error:
    include-message: always
    include-binding-errors: always

# Configuration MedLab
medlab:
  file:
    upload-dir: ${UPLOAD_DIR:/Users/emmanuel/Documents/dev/github/Hgd-Medlabs/data/medlab/uploads}
    watch-dir: ${WATCH_DIR:/Users/emmanuel/Documents/dev/github/Hgd-Medlabs/data/medlab/incoming}
  
  # Configuration du stockage local (conformité hospitalière)
  storage:
    # Répertoire d'archivage des anciens fichiers
    archive-dir: ${ARCHIVE_DIR:/Users/emmanuel/Documents/dev/github/Hgd-Medlabs/data/medlab/archives}
    # Répertoire de sauvegarde
    backup-dir: ${BACKUP_DIR:/Users/emmanuel/Documents/dev/github/Hgd-Medlabs/data/medlab/backups}
    # Durée de rétention avant archivage (jours)
    retention-days-active: ${RETENTION_DAYS:365}
    # Activer l'archivage automatique
    archive-enabled: ${ARCHIVE_ENABLED:false}
  
  security:
    jwt-secret: ${JWT_SECRET:HgdMedLabsSecretKeyForJwtTokenGeneration2026SecureKey256bits}
    jwt-expiration: 86400000 # 24 heures en millisecondes
    access-code-length: 8
    max-access-attempts: 5
    # Clé de chiffrement AES-256 pour les PDFs (OBLIGATOIRE en production!)
    # Minimum 32 caractères pour une sécurité optimale
    encryption-key: ${ENCRYPTION_KEY:HgdMedLabsDefaultEncryptionKey32}
  
  email:
    from: ${EMAIL_FROM:}
    from-name: MedLab - HGD
    base-url: ${BASE_URL:http://localhost:4200}
  
  # Configuration WhatsApp Business API (Meta Cloud)
  # IMPORTANT: Les credentials doivent être dans les variables d'environnement !
  whatsapp:
    enabled: ${WHATSAPP_ENABLED:false}  # Désactivé par défaut, activer via env var
    api-url: https://graph.facebook.com/v18.0
    phone-number-id: ${WHATSAPP_PHONE_NUMBER_ID:}
    access-token: ${WHATSAPP_ACCESS_TOKEN:}
    otp-validity-minutes: 10  # Durée de validité du code OTP
  
  scheduler:
    enabled: true
    fixed-delay: 10000 # 10 secondes

# Swagger/OpenAPI Configuration
springdoc:
  api-docs:
    path: /api/docs
  swagger-ui:
    path: /api/swagger-ui.html
    operations-sorter: method
    tags-sorter: alpha

# Logging
logging:
  level:
    cm.hgd.medlab: DEBUG
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/medlab.log
