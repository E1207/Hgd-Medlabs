<div class="analytics-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <div class="icon-wrapper">
          <mat-icon>insights</mat-icon>
        </div>
        <div>
          <h1>Analytics Pro</h1>
          <p class="subtitle">Tableaux de bord et analyses avancées</p>
        </div>
      </div>
      <div class="header-actions">
        <mat-form-field appearance="outline" class="period-select">
          <mat-select [(ngModel)]="selectedPeriod" (selectionChange)="onPeriodChange()">
            <mat-option *ngFor="let period of periods" [value]="period.value">
              {{ period.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        
        <button mat-stroked-button [matMenuTriggerFor]="exportMenu" class="export-btn">
          <mat-icon>download</mat-icon>
          Exporter
        </button>
        <mat-menu #exportMenu="matMenu">
          <button mat-menu-item (click)="exportPDF()">
            <mat-icon>picture_as_pdf</mat-icon>
            <span>Export PDF</span>
          </button>
          <button mat-menu-item (click)="exportExcel()">
            <mat-icon>table_chart</mat-icon>
            <span>Export Excel</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="scheduleReport()">
            <mat-icon>schedule</mat-icon>
            <span>Planifier un rapport</span>
          </button>
        </mat-menu>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Chargement des analyses...</p>
  </div>

  <!-- Content -->
  <div class="analytics-content" *ngIf="!loading">
    
    <!-- KPI Cards -->
    <div class="kpi-grid">
      <mat-card class="kpi-card">
        <mat-card-content>
          <div class="kpi-icon blue">
            <mat-icon>speed</mat-icon>
          </div>
          <div class="kpi-info">
            <span class="kpi-value">{{ kpis.avgProcessingTime }}h</span>
            <span class="kpi-label">Temps moyen de traitement</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="kpi-card">
        <mat-card-content>
          <div class="kpi-icon green">
            <mat-icon>trending_up</mat-icon>
          </div>
          <div class="kpi-info">
            <span class="kpi-value">+{{ kpis.growthRate }}%</span>
            <span class="kpi-label">Croissance ce mois</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="kpi-card">
        <mat-card-content>
          <div class="kpi-icon orange">
            <mat-icon>schedule</mat-icon>
          </div>
          <div class="kpi-info">
            <span class="kpi-value">{{ kpis.peakHour }}</span>
            <span class="kpi-label">Heure de pointe</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="kpi-card">
        <mat-card-content>
          <div class="kpi-icon purple">
            <mat-icon>emoji_events</mat-icon>
          </div>
          <div class="kpi-info">
            <span class="kpi-value">{{ kpis.bestDay }}</span>
            <span class="kpi-label">Jour le plus actif</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Charts Row 1 -->
    <div class="charts-row">
      <mat-card class="chart-card large">
        <mat-card-header>
          <div class="chart-header">
            <div class="chart-icon blue">
              <mat-icon>show_chart</mat-icon>
            </div>
            <div>
              <mat-card-title>Évolution Mensuelle</mat-card-title>
              <mat-card-subtitle>Tendance sur l'année</mat-card-subtitle>
            </div>
          </div>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas baseChart
              [type]="monthlyTrendChartType"
              [data]="monthlyTrendChartData"
              [options]="monthlyTrendChartOptions">
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card">
        <mat-card-header>
          <div class="chart-header">
            <div class="chart-icon green">
              <mat-icon>pie_chart</mat-icon>
            </div>
            <div>
              <mat-card-title>Types d'Analyses</mat-card-title>
              <mat-card-subtitle>Répartition par catégorie</mat-card-subtitle>
            </div>
          </div>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container pie">
            <canvas baseChart
              [type]="analysisTypeChartType"
              [data]="analysisTypeChartData"
              [options]="analysisTypeChartOptions">
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Charts Row 2 -->
    <div class="charts-row">
      <mat-card class="chart-card">
        <mat-card-header>
          <div class="chart-header">
            <div class="chart-icon orange">
              <mat-icon>access_time</mat-icon>
            </div>
            <div>
              <mat-card-title>Activité par Heure</mat-card-title>
              <mat-card-subtitle>Distribution horaire</mat-card-subtitle>
            </div>
          </div>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas baseChart
              [type]="hourlyChartType"
              [data]="hourlyChartData"
              [options]="hourlyChartOptions">
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card">
        <mat-card-header>
          <div class="chart-header">
            <div class="chart-icon purple">
              <mat-icon>radar</mat-icon>
            </div>
            <div>
              <mat-card-title>Performance par Jour</mat-card-title>
              <mat-card-subtitle>Volume par jour de la semaine</mat-card-subtitle>
            </div>
          </div>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container radar">
            <canvas baseChart
              [type]="weekdayChartType"
              [data]="weekdayChartData"
              [options]="weekdayChartOptions">
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Stats Summary -->
    <mat-card class="summary-card" *ngIf="stats">
      <mat-card-header>
        <div class="chart-header">
          <div class="chart-icon cyan">
            <mat-icon>summarize</mat-icon>
          </div>
          <div>
            <mat-card-title>Résumé de la Période</mat-card-title>
            <mat-card-subtitle>{{ periods | json }}</mat-card-subtitle>
          </div>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div class="summary-grid">
          <div class="summary-item">
            <span class="summary-value">{{ stats.totalResults }}</span>
            <span class="summary-label">Total Résultats</span>
          </div>
          <div class="summary-item">
            <span class="summary-value">{{ stats.resultsSentToday }}</span>
            <span class="summary-label">Envoyés Aujourd'hui</span>
          </div>
          <div class="summary-item">
            <span class="summary-value">{{ stats.openRate | number:'1.0-0' }}%</span>
            <span class="summary-label">Taux d'Ouverture</span>
          </div>
          <div class="summary-item">
            <span class="summary-value">{{ kpis.conversionRate }}%</span>
            <span class="summary-label">Taux de Conversion</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
